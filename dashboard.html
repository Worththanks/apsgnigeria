<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - APSG Admin</title>
    
    <!-- Favicon (added multiple sizes for better mobile/browser support without affecting colors) -->
  <link rel="icon" href="/assets/images/apsg.png" sizes="any" />
  <link rel="apple-touch-icon" href="/assets/images/apsg.png" />
  
    <!-- Prevent flash of wrong theme -->
    <script>
        if (localStorage.getItem("daynight-theme") === "carbon") {
            document.documentElement.classList.add("carbon");
        }
    </script>
    <link rel="stylesheet" href="/assets/css/styles.css">
    
    <!-- Supabase CDN (load once) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<link rel="icon" href="/assets/images/apsg.png" type="image/png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    </script>
    <link rel="stylesheet" href="/assets/css/styles.css">
<style>
    /* Enhanced Premium Dashboard Styles - Compact version with black text */
    :root {
        --primary: #79ecd9;
       

 --primary-light: #eef2ff;
        --success: #10b981;
        --success-light: #d1fae5;
        --warning: #f59e0b;
        --warning-light: #fffbeb;
        --danger: #ef4444;
        --danger-light: #fee2e2;
        --gray-100: #f8fafc;
        --gray-200: #e2e8f0;
        --gray-900: #000000; /* Pure black text */
        --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.1);
        --radius: 12px; /* Slightly reduced radius for tighter look */
        --transition: all 0.3s ease;
    }

    body, .app-container {
        background: var(--gray-100);
        font-family: 'Inter', system-ui, sans-serif;
        color: var(--gray-900); /* Ensure all text inherits pure black */
    }

    .top-nav {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
       

 border-bottom: 1px solid var(--gray-200);
        box-shadow: var(--shadow-sm);
        position: sticky;
        top: 0;
        z-index: 40;
    }

    .logo img {
        height: 36px; /* Slightly smaller logo */
        width: auto;
    }

    .nav-link, .mobile-menu-nav a {
        display: flex;
        align-items: center;
        gap: 8px; /* Reduced gap */
        padding: 8px 12px; /* Reduced padding */
        border-radius: 10px;
        transition: var(--transition);
        color: var(--gray-900);
        font-weight: 500;
    }

    .nav-link:hover, .mobile-menu-nav a:hover {
        background: var(--primary-light);
        color: var(--primary);
    }

    .nav-link.active, .mobile-menu-nav a.active {
        background: var(--primary);
        color: white;
    }

    .nav-link i, .mobile-menu-nav a i {
        font-size: 1.1rem; /* Slightly smaller icons */
    }

    .card {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow-md);
        padding: 1rem; /* Reduced from 1.5rem */
        transition: var(--transition);
    }

    .card:hover {
        transform: translateY(-4px); /* Reduced lift */
        box-shadow: 0 16px 32px rgba(0, 0, 0, 0.12);
    }

    .stat-icon {
        width: 48px; /* Reduced from 64px */
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem; /* Reduced icon size */
        box-shadow: var(--shadow-sm);
    }

    .page-header {
        background: linear-gradient(135deg, #fdfdfd 0%, #d5dbd1 100%);
        color: black;
        border-radius: var(--radius);
        padding: 2rem 1.5rem; /* Reduced from 3rem 2rem */
        margin-bottom: 1.5rem; /* Reduced from 2rem */
        box-shadow: var(--shadow-md);
    }

    .page-title {
        font-size: 2rem; /* Reduced from 2.5rem */
        font-weight: 800;
        margin: 0 0 0.5rem 0;
    }

    .page-subtitle {
        font-size: 1rem; /* Reduced from 1.125rem */
        opacity: 0.95;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem; /* Reduced from 1.5rem */
        margin-bottom: 1.5rem; /* Reduced from 2rem */
    }

    .two-col {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1 appreciative; /* Reduced from 1.5rem */
    }

    @media (max-width: 1024px) {
        .two-col {
            grid-template-columns: 1fr;
        }
    }

    .bar {
        background: linear-gradient(to top, var(--primary), #a78bfa);
        border-radius: 8px;
        transition: height 0.6s ease;
    }

    /* Additional compact adjustments */
    .card-title {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
    }
    .card-subtitle {
        font-size: 0.875.rem;
        color: var(--gray-900);
    }
    .stat-label {
        font-size: 0.875rem;
        color: var(--gray-900);
    }
    .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--gray-900);
    }
    .bar-label {
        font-size: 0.8rem;
        color: var(--gray-900);
    }
</style>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay"></div>

<!-- Mobile Menu -->
<div class="mobile-menu">
    <div class="mobile-menu-header">
        <a href="dashboard.html" class="logo">
            <img src="/assets/images/apsg.png" alt="APSG Logo">
            APSG Admin
        </a>
        <button class="mobile-menu-close" onclick="closeMobileMenu()">
            <i class="fas fa-times"></i>
        </button>
    </div>
      <nav class="mobile-menu-nav">
            <a href="dashboard.html">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7" rx="1"/>
                    <rect x="14" y="3" width="7" height="7" rx="1"/>
                    <rect x="3" y="14" width="7" height="7" rx="1"/>
                    <rect x="14" y="14" width="7" height="7" rx="1"/>
                </svg>
                Dashboard
            </a>
            <a href="members.html" class="active">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4-4v-2a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                Members
            </a>
        </nav>
        <div class="mobile-menu-footer">
            <a class="mobile-logout-btn" style="cursor:pointer;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                Logout
            </a>
            <div class="theme-toggle">
                <button class="theme-btn theme-btn-snow active" onclick="setTheme('snow')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                </button>
                <button class="theme-btn theme-btn-carbon" onclick="setTheme('carbon')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

<div class="app-container">
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-left">
                <a href="dashboard.html" class="logo">
                    <img src="/assets/images/apsg.png" alt="APSG Logo">
                    APSG Admin
                </a>
                    <div class="nav-menu">
                        <div class="nav-item">
                            <a href="dashboard.html" class="nav-link active">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7" rx="1"/>
                                    <rect x="14" y="3" width="7" height="7" rx="1"/>
                                    <rect x="3" y="14" width="7" height="7" rx="1"/>
                                    <rect x="14" y="14" width="7" height="7" rx="1"/>
                                </svg>
                                Dashboard
                            </a>
                        </div>
                        <div class="nav-item">
                            <a href="members.html" class="nav-link ">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4-4v-2a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                </svg>
                                Members
                            </a>
                        </div>
                    </div>
                </div>
                <div class="nav-right">
                    <div class="theme-toggle">
                        <button class="theme-btn theme-btn-snow active" onclick="setTheme('snow')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"/>
                                <line x1="12" y1="1" x2="12" y2="3"/>
                                <line x1="12" y1="21" x2="12" y2="23"/>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                <line x1="1" y1="12" x2="3" y2="12"/>
                                <line x1="21" y1="12" x2="23" y2="12"/>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                            </svg>
                        </button>
                        <button class="theme-btn theme-btn-carbon" onclick="setTheme('carbon')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                            </svg>
                        </button>
                    </div>
                    <button class="btn-logout" style="cursor:pointer;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                    </button>
                </div>
            </div>
        </nav>


    <main class="main-content">
        <div class="page-header">
            <div>
                <h1 class="page-title">APSG Dashboard</h1>
                <p class="page-subtitle">Overview of APC Progressive Support Group (APSG) With PVC and APC Membership Card</p>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="card">
                <div class="stat-icon" style="background: var(--primary-light); color: var(--primary);">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <p class="stat-label">Total Members</p>
                    <p class="stat-value">0</p>
                </div>
            </div>

            <div class="card">
                <div class="stat-icon" style="background: var(--success-light); color: var(--success);">
                    <i class="fas fa-calendar-day"></i>
                </div>
                <div class="stat-info">
                    <p class="stat-label">Today's Registrations</p>
                    <p class="stat-value">0</p>
                </div>
            </div>

<div class="card">
    <div class="stat-icon" style="background: var(--primary-light); color: var(--primary);">
        <i class="fas fa-trophy"></i>
    </div>
    <div class="stat-info">
        <p class="stat-label">Top Three States</p>
        <p class="stat-value" id="topStatesValue">Loading...</p>
    </div>
</div>

            <div class="card">
                <div class="stat-icon" style="background: var(--danger-light); color: var(--danger);">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="stat-info">
                    <p class="stat-label">Active States</p>
                    <p class="stat-value">0</p>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="two-col">
            <!-- State Distribution Donut Chart -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Registrations by State</h3>
                    <p class="card-subtitle">Top states (others grouped)</p>
                </div>
                <div class="chart-scroll">
                    <div class="chart-scroll-inner">
                        <div class="donut-chart">
                            <svg viewBox="0 0 36 36">
                                <circle class="donut-ring" cx="18" cy="18" r="15.9" fill="none" stroke="#e2e8f0" stroke-width="3"/>
                                <circle class="donut-segment" cx="18" cy="18" r="15.9" fill="none" stroke="#4f46e5" stroke-width="3" stroke-dasharray="60 100"/>
                                <circle class="donut-segment" cx="18" cy="18" r="15.9" fill="none" stroke="#10b981" stroke-width="3" stroke-dasharray="25 100" stroke-dashoffset="-60"/>
                                <circle class="donut-segment" cx="18" cy="18" r="15.9" fill="none" stroke="#f59e0b" stroke-width="3" stroke-dasharray="10 100" stroke-dashoffset="-85"/>
                                <circle class="donut-segment" cx="18" cy="18" r="15.9" fill="none" stroke="#ef4444" stroke-width="3" stroke-dasharray="5 100" stroke-dashoffset="-95"/>
                            </svg>
                            <div class="donut-center">
                                <div class="donut-value">0</div>
                                <div class="donut-label">Total</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Registrations Bar Chart -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Registrations</h3>
                    <p class="card-subtitle">Last 7 days</p>
                </div>
                <div class="bar-chart">
                    <div class="bar-container">
                        <div class="bar-group">
                            <div class="bar-wrapper"><div class="bar"></div></div>
                            <span class="bar-label">6 days ago</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar-wrapper"><div class="bar"></div></div>
                            <span class="bar-label">5 days ago</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar-wrapper"><div class="bar"></div></div>
                            <span class="bar-label">4 days ago</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar-wrapper"><div class="bar"></div></div>
                            <span class="bar-label">3 days ago</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar-wrapper"><div class="bar"></div></div>
                            <span class="bar-label">2 days ago</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar-wrapper"><div class="bar"></div></div>
                            <span class="bar-label">Yesterday</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar-wrapper"><div class="bar"></div></div>
                            <span class="bar-label">Today</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Data Message -->
        <div id="noDataMessage" class="text-center mt-4" style="display:none;">
            <p class="text-muted fs-5">No registrations yet. Data will appear here once members start registering.</p>
        </div>
    </main>

    <footer class="footer">
        <p>© 2026 APSG Nigeria Admin Dashboard</p>
    </footer>
</div>
    <!-- Shared Supabase Auth & Client (from supabase-clients.js) -->
    <script src="/assets/js/supabase-clients.js"></script>

    <!-- Dashboard-Specific Data Loading Script -->
    <script>
        async function loadDashboard() {
            const { data: members, error } = await supabaseClient.from('members').select('*');
            
            if (error) {
                console.error('Error loading members:', error);
                document.getElementById('noDataMessage').innerHTML = '<p class="text-danger">Error loading data. Check console for details.</p>';
                document.getElementById('noDataMessage').style.display = 'block';
                return;
            }

            if (!members || members.length === 0) {
                document.getElementById('noDataMessage').style.display = 'block';
                return;
            }

            const total = members.length;
            const today = new Date().toISOString().slice(0, 10);
            const todaysCount = members.filter(m => m.created_at?.slice(0, 10) === today).length;

            // Update stats
            document.querySelectorAll('.stat-value')[0].textContent = total.toLocaleString();
            document.querySelectorAll('.stat-value')[1].textContent = todaysCount;

            // State donut chart
            const stateCounts = {};
            members.forEach(m => stateCounts[m.state] = (stateCounts[m.state] || 0) + 1);
            const sortedStates = Object.entries(stateCounts).sort((a, b) => b[1] - a[1]).slice(0, 5);
            const others = total - sortedStates.reduce((s, [_, c]) => s + c, 0);
            if (others > 0) sortedStates.push(['Others', others]);

            const donutSegments = document.querySelectorAll('.donut-segment');
            let offset = 0;
            const colors = ['var(--accent)', 'var(--success)', 'var(--warning)', '#A855F7', '#EC4899', '#94A3B8'];
            donutSegments.forEach(segment => {
                segment.style.strokeDasharray = '0 100';
                segment.style.strokeDashoffset = '0';
            });
            sortedStates.forEach(([state, count], i) => {
                const percent = (count / total * 100);
                donutSegments[i].style.strokeDasharray = `${percent} 100`;
                donutSegments[i].style.strokeDashoffset = -offset;
                donutSegments[i].style.stroke = colors[i % colors.length];
                offset += percent;
            });
            document.querySelector('.donut-value').textContent = total;

            // Last 7 days bar chart (oldest to newest)
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date.toISOString().slice(0, 10));
            }
            const counts = last7Days.map(date => 
                members.filter(m => m.created_at?.slice(0, 10) === date).length
            );

            const bars = document.querySelectorAll('.bar');
            bars.forEach((bar, i) => {
                const count = counts[i] || 0;
                bar.style.height = Math.max(20, count * 15) + 'px';
            });
        }

        async function loadTopStates() {
    const { data: members, error } = await supabaseClient
        .from('members')
        .select('state');

    if (error) {
        console.error('Error loading top states:', error);
        document.getElementById('topStatesValue').textContent = 'Error';
        return;
    }

    if (!members || members.length === 0) {
        document.getElementById('topStatesValue').textContent = 'No registrations yet';
        return;
    }

    // Count registrations per state
    const stateCounts = members.reduce((acc, member) => {
        const state = member.state?.trim();
        if (state) {
            acc[state] = (acc[state] || 0) + 1;
        }
        return acc;
    }, {});

    // Sort by count descending and take top 3
    const topThree = Object.entries(stateCounts)
        .sort(([, a], [, b]) => b - a)
        .slice(0, 3)
        .map(([state, count], index) => `${index + 1}. ${state} (${count})`)
        .join('   •   ');  // Nice separator for readability

    document.getElementById('topStatesValue').textContent = topThree || 'No data';
}

// Call this function in your main dashboard load (e.g., after loading total/today stats)
document.addEventListener('DOMContentLoaded', async () => {
    await checkAuth();
    // ... your existing loads (total members, today, etc.)
    await loadTopStates();  // Add this line
});

        // Run after auth check
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth(); // From supabase-clients.js
            loadDashboard();
        });
    </script>

    <!-- DayNight Theme Script -->
    <script src="/assets/js/styles.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/assets/js/supabase-clients.js"></script>
<script src="/assets/js/dashboard.js"></script>
<script src="/assets/js/styles.js"></script>

</body>
</html>